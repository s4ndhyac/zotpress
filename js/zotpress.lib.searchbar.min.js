jQuery(document).ready(function()
{if(jQuery("#zp-Zotpress-SearchBox").length>0)
{var zpItemsFlag=!0;var zpItemNum=1;var zpLastTerm="";var zpSearchBarParams="";var zpSearchBarSource=zpShortcodeAJAX.ajaxurl+"?action=zpRetrieveViaShortcode&zpShortcode_nonce="+zpShortcodeAJAX.zpShortcode_nonce;var zpShowImages=!1;if(jQuery("#ZOTPRESS_AC_IMAGES").length>0)zpShowImages=!0;function zp_set_lib_searchbar_params(filter,start,last)
{if(typeof(filter)==="undefined"||filter=="false"||filter=="")
filter=!1;if(typeof(start)==="undefined"||start=="false"||start=="")
start=!1;if(typeof(last)==="undefined"||last=="false"||last=="")
last=!1;zpSearchBarParams="";zpSearchBarParams+="&api_user_id="+jQuery("#ZOTPRESS_USER").val();zpSearchBarParams+="&item_type=items";zpSearchBarParams+="&downloadable="+jQuery("#ZOTPRESS_AC_DOWNLOAD").val();zpSearchBarParams+="&style="+jQuery("#ZP_STYLE").text();zpSearchBarParams+="&sort_by="+jQuery("#ZP_SORTBY").text();zpSearchBarParams+="&order="+jQuery("#ZP_ORDER").text();zpSearchBarParams+="&citeable="+jQuery("#ZOTPRESS_AC_CITE").val();if(jQuery("#ZOTPRESS_AC_MAXRESULTS").val().length>0)
zpSearchBarParams+="&maxresults="+jQuery("#ZOTPRESS_AC_MAXRESULTS").val();if(zpShowImages)zpSearchBarParams+="&showimage=true";if(start)zpSearchBarParams+="&request_start="+start;if(last)zpSearchBarParams+="&request_last="+last;zpSearchBarParams+="&update=true";if(filter)
zpSearchBarParams+="&filter="+filter;else if(jQuery("input[name=zpSearchFilters]").length>0)
zpSearchBarParams+="&filter="+jQuery("input[name=zpSearchFilters]:checked").val()}
zp_set_lib_searchbar_params(!1,!1,!1);jQuery("input[name='zpSearchFilters']").click(function()
{if(jQuery("input[name=zpSearchFilters]").length>0)
zp_set_lib_searchbar_params(jQuery(this).val(),!1,!1);jQuery("input#zp-Zotpress-SearchBox-Input").autocomplete("option","source",zpSearchBarSource+zpSearchBarParams);if(jQuery("input#zp-Zotpress-SearchBox-Input").val().length>0&&jQuery("input#zp-Zotpress-SearchBox-Input").val()!=zpShortcodeAJAX.txt_typetosearch)
jQuery("input#zp-Zotpress-SearchBox-Input").autocomplete("search")});jQuery("input#zp-Zotpress-SearchBox-Input").bind("keydown",function(event)
{if(event.keyCode===jQuery.ui.keyCode.TAB&&jQuery(this).data("autocomplete").menu.active){event.preventDefault()}
if(event.keyCode===13){event.preventDefault()}}).bind("focus",function(event)
{if(jQuery(this).val()==zpShortcodeAJAX.txt_typetosearch){jQuery(this).val("");jQuery(this).removeClass("help")}}).bind("blur",function(event)
{if(jQuery.trim(jQuery(this).val())==""){jQuery(this).val(zpShortcodeAJAX.txt_typetosearch);jQuery(this).addClass("help")}}).autocomplete({source:zpSearchBarSource+zpSearchBarParams,minLength:jQuery("#ZOTPRESS_AC_MINLENGTH").val(),focus:function(){return!1},search:function(event,ui)
{var tempCurrentTerm=!1;if(event.hasOwnProperty('currentTarget'))tempCurrentTerm=event.currentTarget.value;zpItemNum=1;if(zpItemsFlag==!0||(tempCurrentTerm&&tempCurrentTerm!=zpLastTerm))
{jQuery(".zp-List .zpSearchLoading").addClass("show");if(jQuery("#zpSearchResultsPaging").length>0)jQuery("#zpSearchResultsPaging").empty();jQuery("#zpSearchResultsContainer").empty();zp_set_lib_searchbar_params(!1,0,0);jQuery("input#zp-Zotpress-SearchBox-Input").autocomplete("option","source",zpSearchBarSource+zpSearchBarParams);window.zpPage=1;if(zpItemsFlag==!0&&tempCurrentTerm)
zpLastTerm=tempCurrentTerm}},response:function(event,ui)
{jQuery(".zp-List .zpSearchLoading").removeClass("show");if(ui.content!="0")
{jQuery.each(ui.content[2],function(index,item)
{var temp="<div id='zp-Entry-"+item.key+"' class='zp-Entry zpSearchResultsItem hidden'>\n";if(zpShowImages&&item.hasOwnProperty('image'))
{temp+="<div id='zp-Citation-"+item.key+"' class='zp-Entry-Image hasImage' rel='"+item.key+"'>\n";temp+="<img class='thumb' src='"+item.image[0]+"' alt='image' />\n";temp+="</div><!-- .zp-Entry-Image -->\n"}
if(item.bib.indexOf("[1]")!=-1)
{item.bib=item.bib.replace("[1]","["+zpItemNum+"]");zpItemNum++}
temp+=item.bib;if(jQuery("input#tag[name=zpSearchFilters]:checked").length>0)
{temp+="<span class='item_key'>Tag(s): ";jQuery.each(item.data.tags,function(tindex,tagval)
{if(tindex!=0)temp+=", ";temp+=tagval.tag})}
jQuery("#zpSearchResultsContainer").append(temp+"</div><!-- .zp-Entry -->\n")});if(ui.content[1].request_next!=!1&&ui.content[1].request_next!="false")
{if(zpItemsFlag==!0)window.zpACPagination(zpItemsFlag,!1);else window.zpACPagination(zpItemsFlag,!0);zpItemsFlag=!1;zp_set_lib_searchbar_params(!1,ui.content[1].request_next,ui.content[1].request_last);jQuery("input#zp-Zotpress-SearchBox-Input").autocomplete("option","source",zpSearchBarSource+zpSearchBarParams);jQuery("input#zp-Zotpress-SearchBox-Input").autocomplete("search")}
else{window.zpACPagination(zpItemsFlag,!0);zpItemsFlag=!1}}
else{if(jQuery("#zpSearchResultsPaging").length>0)jQuery("#zpSearchResultsPaging").empty();jQuery("#zpSearchResultsContainer").append("<p>No items found.</p>\n")}},open:function()
{jQuery(".ui-autocomplete").hide()}})}})
