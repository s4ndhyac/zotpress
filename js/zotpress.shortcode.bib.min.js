jQuery(document).ready(function()
{if(jQuery(".zp-Zotpress-Bib").length>0)
{jQuery(".zp-Zotpress-Bib").each(function(index,instance)
{var $instance=jQuery(instance);var zp_params={};zp_params.zpItemkey=!1;if(jQuery(".ZP_ITEM_KEY",$instance).text().trim().length>0)zp_params.zpItemkey=jQuery(".ZP_ITEM_KEY",$instance).text();zp_params.zpCollectionId=!1;if(jQuery(".ZP_COLLECTION_ID",$instance).text().trim().length>0)zp_params.zpCollectionId=jQuery(".ZP_COLLECTION_ID",$instance).text();zp_params.zpTagId=!1;if(jQuery(".ZP_TAG_ID",$instance).text().trim().length>0)zp_params.zpTagId=jQuery(".ZP_TAG_ID",$instance).text();zp_params.zpAuthor=!1;if(jQuery(".ZP_AUTHOR",$instance).text().trim().length>0)zp_params.zpAuthor=jQuery(".ZP_AUTHOR",$instance).text();zp_params.zpYear=!1;if(jQuery(".ZP_YEAR",$instance).text().trim().length>0)zp_params.zpYear=jQuery(".ZP_YEAR",$instance).text();zp_params.zpStyle=!1;if(jQuery(".ZP_STYLE",$instance).text().trim().length>0)zp_params.zpStyle=jQuery(".ZP_STYLE",$instance).text();zp_params.zpLimit=!1;if(jQuery(".ZP_LIMIT",$instance).text().trim().length>0)zp_params.zpLimit=jQuery(".ZP_LIMIT",$instance).text();zp_params.zpTitle=!1;if(jQuery(".ZP_TITLE",$instance).text().trim().length>0)zp_params.zpTitle=jQuery(".ZP_TITLE",$instance).text();zp_params.zpShowImages=!1;if(jQuery(".ZP_SHOWIMAGE",$instance).text().trim().length>0)zp_params.zpShowImages=jQuery(".ZP_SHOWIMAGE",$instance).text().trim();zp_params.zpShowTags=!1;if(jQuery(".ZP_SHOWTAGS",$instance).text().trim().length>0)zp_params.zpShowTags=!0;zp_params.zpDownloadable=!1;if(jQuery(".ZP_DOWNLOADABLE",$instance).text().trim().length>0)zp_params.zpDownloadable=!0;zp_params.zpInclusive=!1;if(jQuery(".ZP_INCLUSIVE",$instance).text().trim().length>0)zp_params.zpInclusive=!0;zp_params.zpShowNotes=!1;if(jQuery(".ZP_NOTES",$instance).text().trim().length>0)zp_params.zpShowNotes=!0;zp_params.zpShowAbstracts=!1;if(jQuery(".ZP_ABSTRACT",$instance).text().trim().length>0)zp_params.zpShowAbstracts=!0;zp_params.zpCiteable=!1;if(jQuery(".ZP_CITEABLE",$instance).text().trim().length>0)zp_params.zpCiteable=!0;zp_params.zpTarget=!1;if(jQuery(".ZP_TARGET",$instance).text().trim().length>0)zp_params.zpTarget=!0;zp_params.zpURLWrap=!1;if(jQuery(".ZP_URLWRAP",$instance).text().trim().length>0)zp_params.zpURLWrap=jQuery(".ZP_URLWRAP",$instance).text();zp_params.zpHighlight=!1;if(jQuery(".ZP_HIGHLIGHT",$instance).text().trim().length>0)zp_params.zpHighlight=jQuery(".ZP_HIGHLIGHT",$instance).text();zp_params.zpForceNumsCount=1;if(zp_params.zpCollectionId&&zp_params.zpCollectionId.indexOf(",")!=-1)
{var tempCollections=zp_params.zpCollectionId.split(",");jQuery.each(tempCollections,function(i,collection)
{zp_params.zpCollectionId=collection;zp_get_items(0,0,$instance,zp_params,!1)})}
else{if(zp_params.zpTagId&&zp_params.zpInclusive==!0&&zp_params.zpTagId.indexOf(",")!=-1)
{var tempTags=zp_params.zpTagId.split(",");jQuery.each(tempTags,function(i,tag)
{zp_params.zpTagId=tag;zp_get_items(0,0,$instance,zp_params,!1)})}
else{if(zp_params.zpAuthor&&zp_params.zpAuthor.indexOf(",")!=-1)
{var tempAuthors=zp_params.zpAuthor.split(",");if(zp_params.zpInclusive==!0)
{jQuery.each(tempAuthors,function(i,author)
{zp_params.zpAuthor=author;zp_get_items(0,0,$instance,zp_params,!1)})}
else{zp_get_items(0,0,$instance,zp_params,!1)}}
else{if(zp_params.zpYear&&zp_params.zpYear.indexOf(",")!=-1)
{var tempYears=zp_params.zpYear.split(",");jQuery.each(tempYears,function(i,year)
{zp_params.zpYear=year;zp_get_items(0,0,$instance,zp_params,!1)})}
else{zp_get_items(0,0,$instance,zp_params,!1)}}}}})}
function zp_get_items(request_start,request_last,$instance,params,update)
{if(typeof(request_start)==="undefined"||request_start=="false"||request_start=="")
request_start=0;if(typeof(request_last)==="undefined"||request_last=="false"||request_last=="")
request_last=0;jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{'action':'zpRetrieveViaShortcode','instance_id':$instance.attr("id"),'api_user_id':jQuery(".ZP_API_USER_ID",$instance).text(),'item_type':jQuery(".ZP_DATATYPE",$instance).text(),'item_key':params.zpItemkey,'collection_id':params.zpCollectionId,'tag_id':params.zpTagId,'author':params.zpAuthor,'year':params.zpYear,'style':params.zpStyle,'limit':params.zpLimit,'title':params.zpTitle,'showimage':params.zpShowImages,'showtags':params.zpShowTags,'downloadable':params.zpDownloadable,'inclusive':params.zpInclusive,'shownotes':params.zpShowNotes,'showabstracts':params.zpShowAbstracts,'citeable':params.zpCiteable,'target':params.zpTarget,'urlwrap':params.zpURLWrap,'highlight':params.zpHighlight,'sort_by':jQuery(".ZP_SORTBY",$instance).text(),'order':jQuery(".ZP_ORDER",$instance).text(),'update':update,'request_start':request_start,'request_last':request_last,'zpShortcode_nonce':zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(data)
{var zp_items=jQuery.parseJSON(data);if(typeof zp_items!='undefined'&&zp_items!=null&&zp_items!=0&&zp_items.data.length>0)
{var tempItems="";if(params.zpShowNotes==!0)var tempNotes="";if(params.zpTitle==!0)var tempTitle="";if(update===!1)
{jQuery("#"+zp_items.instance+" .zp-List").addClass("used_cache")}
else if(update===!0)
{if(!jQuery("#"+zp_items.instance+" .zp-List").hasClass("updating")&&jQuery("#"+zp_items.instance+" .zp-Citation-Notes").length>0)
jQuery("#"+zp_items.instance+" .zp-Citation-Notes").remove();if(!jQuery("#"+zp_items.instance+" .zp-List").hasClass("updating"))
jQuery("#"+zp_items.instance+" .zp-List").addClass("updating");params.zpForceNumsCount=1}
jQuery.each(zp_items.data,function(index,item)
{var tempItem="";var $item_ref=jQuery("#"+zp_items.instance+" .zp-List #zp-ID-"+jQuery(".ZP_API_USER_ID",$instance).text()+"-"+item.key);if($item_ref.length>0)
{if(update===!1&&!jQuery("#"+zp_items.instance+" .zp-List").hasClass("used_cache"))
return!1}
var tempItemYear="0000";if(item.meta.hasOwnProperty('parsedDate'))
tempItemYear=item.meta.parsedDate.substring(0,4);var tempAuthor=item.data.title;if(item.meta.hasOwnProperty('creatorSummary'))
tempAuthor=item.meta.creatorSummary.replace(/ /g,"-");if(params.zpTitle==!0)
{if(tempTitle!=tempItemYear)
{tempTitle=tempItemYear;tempItems+="<h3>"+tempTitle+"</h3>\n"}}
tempItem+="<div id='zp-ID-"+jQuery(".ZP_API_USER_ID",$instance).text()+"-"+item.key+"'";tempItem+=" data-zp-author-year='"+tempAuthor+"-"+tempItemYear+"'";tempItem+=" data-zp-year-author='"+tempItemYear+"-"+tempAuthor+"'";tempItem+=" class='zp-Entry zpSearchResultsItem";if(update===!0)tempItem+=" zp_updated";if(jQuery("#"+zp_items.instance+" .ZP_SHOWIMAGE").text().trim().length>0&&item.hasOwnProperty('image'))
{tempItem+=" zp-HasImage'>\n";tempItem+="<div id='zp-Citation-"+item.key+"' class='zp-Entry-Image hasImage' rel='"+item.key+"'>\n";if(params.zpURLWrap=="image"&&item.data.url!="")
{tempItem+="<a href='"+item.data.url+"'";if(params.zpTarget)tempItem+=" target='_blank'";tempItem+=">"}
tempItem+="<img class='thumb' src='"+item.image[0]+"' alt='image' />\n";if(params.zpURLWrap=="image"&&item.data.url!="")tempItem+="</a>";tempItem+="</div><!-- .zp-Entry-Image -->\n"}
else{tempItem+="'>\n"}
if(jQuery("#"+zp_items.instance+" .ZP_FORCENUM").text().length>0&&jQuery("#"+zp_items.instance+" .ZP_FORCENUM").text()=="1")
{if(!/csl-left-margin/i.test(item.bib))
{item.bib=item.bib.replace('<div class="csl-entry">','<div class="csl-entry">'+params.zpForceNumsCount+". ");params.zpForceNumsCount++}}
tempItem+=item.bib;if(params.zpShowAbstracts==!0&&(item.data.hasOwnProperty('abstractNote')&&item.data.abstractNote.length>0))
tempItem+="<p class='zp-Abstract'><span class='zp-Abstract-Title'>Abstract:</span> "+item.data.abstractNote+"</p>\n";if(params.zpShowTags==!0&&(item.data.hasOwnProperty('tags')&&item.data.tags.length>0))
{tempItem+="<p class='zp-Zotpress-ShowTags'><span class='title'>Tags:</span> ";jQuery.each(item.data.tags,function(tindex,tag)
{tempItem+="<span class='tag'>"+tag.tag+"</span>";if(tindex!=(item.data.tags.length-1))tempItem+="<span class='separator'>,</span> "});tempItem+="</p>\n"}
tempItem+="</div><!-- .zp-Entry -->\n";if(params.zpShowNotes==!0&&item.hasOwnProperty('notes'))
tempNotes+=item.notes;if($item_ref.length>0&&update===!0)
{$item_ref.replaceWith(jQuery(tempItem))}
else{tempItems+=tempItem}});if(update===!1)jQuery("#"+zp_items.instance+" .zp-List").append(tempItems);if(params.zpShowNotes==!0&&tempNotes.length>0)
{tempNotes="<div class='zp-Citation-Notes'>\n<h4>Notes</h4>\n<ol>\n"+tempNotes;tempNotes=tempNotes+"</ol>\n</div><!-- .zp-Citation-Notes -->\n\n";jQuery("#"+zp_items.instance).append(tempNotes)}
if(jQuery("#"+zp_items.instance+" .zp-List .csl-left-margin").length>0)
{params.zpForceNumsCount=1;jQuery("#"+zp_items.instance+" .zp-List .csl-left-margin").each(function(index,item)
{var item_content=jQuery(item).text();item_content=item_content.replace(item_content.match(/\d+/)[0],params.zpForceNumsCount);jQuery(item).text(item_content);params.zpForceNumsCount++})}
if(zp_items.meta.request_next!=!1&&zp_items.meta.request_next!="false")
{zp_get_items(zp_items.meta.request_next,zp_items.meta.request_last,$instance,params,update)}
else{jQuery("#"+zp_items.instance+" .zp-List").removeClass("loading");if(!jQuery("#"+zp_items.instance+" .zp-List").hasClass("updating"))
{zp_get_items(0,0,$instance,params,!0)}
else{var sortby=jQuery(".ZP_SORTBY",$instance).text();var orderby=jQuery(".ZP_ORDER",$instance).text();if(["author","date"].indexOf(sortby)!==-1&&jQuery("#"+zp_items.instance+" .zp-List .csl-left-margin").length==0)
{var sortOrder="data-zp-author-year";if(sortby=="date")sortOrder="data-zp-year-author";jQuery("#"+zp_items.instance+" .zp-List div.zp-Entry").sort(function(a,b)
{var an=a.getAttribute(sortOrder).toLowerCase(),bn=b.getAttribute(sortOrder).toLowerCase();if(an>bn)
if(orderby=="asc")
return 1;else return-1;else if(an<bn)
if(orderby=="asc")
return-1;else return 1;else return 0}).detach().appendTo("#"+zp_items.instance+" .zp-List")}}}}
else{if(update===!0)
{jQuery("#"+$instance.attr("id")+" .zp-List").removeClass("loading");if(jQuery("#"+$instance.attr("id")+" .zp-List .zp-Entry").length==0)
jQuery("#"+$instance.attr("id")+" .zp-List").append("<p>There are no citations to display.</p>\n")}}},error:function(errorThrown)
{console.log("Error: ");console.log(errorThrown)}})}})
